!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Orbity=e()}(this,(function(){"use strict";const t="sphere";return class{constructor(e,s={}){this.canvas=e,this.ctx=e.getContext("2d"),this.tags=[],this.settings=Object.assign({radius:150,speed:1,easing:.1,enableEasing:!0,paused:!1,enableTouch:!0,enableOrientation:!1,maxVelocity:.5,shape:t,enableDrag:!0,enableClick:!0,autoSpin:!0,hoverEffect:!0,clickEffect:!0,hoverScale:1.2,hoverColor:"#ff0",hoverOpacity:1,customFont:"sans-serif",customFontWeight:"normal"},s),this.rotation={x:0,y:0},this.velocity={x:0,y:0},this.touch={x:0,y:0,active:!1},this.animFrame=null,this._events={tagClick:[],tagHover:[],tagLeave:[]},this._hoveredIndex=null,this.settings.easing=Math.min(Math.max(this.settings.easing,.01),.5),this.settings.speed=Math.min(Math.max(this.settings.speed,.1),5),this._orientationHandler=this._handleOrientation.bind(this),this._touchStartHandler=this._onTouchStart.bind(this),this._touchMoveHandler=this._onTouchMove.bind(this),this._mouseMoveHandler=this._onCanvasMouseMove.bind(this),this._mouseLeaveHandler=this._onCanvasMouseLeave.bind(this),this._clickHandler=this._onCanvasClick.bind(this),this._init()}_throttle(t,e){let s,i;return function(...n){const a=this;i?(clearTimeout(s),s=setTimeout((function(){Date.now()-i>=e&&(t.apply(a,n),i=Date.now())}),e-(Date.now()-i))):(t.apply(a,n),i=Date.now())}}_init(){this._resize=this._throttle(this._resize.bind(this),200),this._onCanvasMouseMove=this._throttle(this._onCanvasMouseMove.bind(this),50),window.addEventListener("resize",this._resize),this._bindTouch(),this._bindMouse(),this._bindOrientation(),this._attachInteraction(),this.canvas.setAttribute("role","img"),this.canvas.setAttribute("aria-label","3D tag cloud visualization"),this._resize(),this._positionTags(),this._animate()}_resize(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.center={x:this.canvas.width/2,y:this.canvas.height/2},this._positionTags()}setTags(t){this.tags=t.map(((t,e)=>({...t,angleX:2*Math.random()*Math.PI,angleY:Math.random()*Math.PI,index:e,_screen:{},_scale:1,_color:t.color,_opacity:1}))),this._positionTags(),this._draw()}_getRandomAngle(){return 2*Math.random()*Math.PI}addTag(t){this._validateTag(t)&&(this.tags.push({...t,angleX:this._getRandomAngle(),angleY:this._getRandomAngle(),index:this.tags.length,_screen:{},_scale:1,_color:t.color,_opacity:1}),this._positionTags())}removeTag(t){this.tags.splice(t,1),this._positionTags()}updateTag(t,e){this.tags[t]?(Object.assign(this.tags[t],e,{_scale:1,_color:e.color||this.tags[t].color,_opacity:1}),this._positionTags()):console.error(`Tag at index ${t} does not exist.`)}clearTags(){this.tags=[]}updateOptions(e){if(this.settings={...this.settings,...e},void 0!==e.easing&&("number"!=typeof e.easing?(console.error("Invalid easing: must be a number"),this.settings.easing=.1):this.settings.easing=e.easing),void 0!==e.speed&&("number"!=typeof e.speed?(console.error("Invalid speed: must be a "),this.settings.speed=1):this.settings.speed=e.speed),void 0!==e.radius&&("number"!=typeof e.radius||e.radius<=0)&&(console.error("Invalid radius: must be a positive number."),this.settings.radius=150),void 0!==e.shape){const s=["sphere","cube","plane","helix","ring","verticalRing","cylinder","pyramid"];s.includes(e.shape)||(console.error(`Invalid shape: must be one of ${s.join(", ")}.`),this.settings.shape=t)}void 0!==e.maxVelocity&&("number"!=typeof e.maxVelocity||e.maxVelocity<0)&&(console.error("Invalid maxVelocity: must be a non-negative number."),this.settings.maxVelocity=.5),void 0===e.radius&&void 0===e.shape||this._positionTags(),void 0!==e.enableTouch&&(e.enableTouch?this._bindTouch():(this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch))),void 0!==e.enableOrientation&&(e.enableOrientation?this._bindOrientation():window.removeEventListener("deviceorientation",this._orientationHandler)),void 0!==e.enableClick&&(e.enableClick?this.canvas.addEventListener("click",this._clickHandler):this.canvas.removeEventListener("click",this._clickHandler)),void 0!==e.paused&&(e.paused?this.pause():this.resume())}_validateTag(t){return t.text&&"string"==typeof t.text?!(!t.color||!/^#[0-9A-F]{6}$/i.test(t.color))||(console.error("Invalid tag: 'color' must be a valid hex color code."),!1):(console.error("Invalid tag: 'text' is required and must be a string."),!1)}_bindDragEvents(t,e,s,i){let n=!1,a=0,o=0;this.canvas.addEventListener(t,(t=>{n=!0;const e=i(t);a=e.x,o=e.y,0===this.velocity.x&&0===this.velocity.y&&(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed)})),this.canvas.addEventListener(e,(t=>{if(!n)return;const e=i(t),s=e.x-a,h=e.y-o;this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(h*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(s*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=h*this.settings.speed*.1,this.velocity.y=s*this.settings.speed*.1),a=e.x,o=e.y,t.preventDefault&&t.preventDefault()}),{passive:!1}),this.canvas.addEventListener(s,(()=>{n=!1,this._applyDragEasing()})),this.canvas.addEventListener("mouseleave",(()=>{n&&(n=!1,this._applyDragEasing())}))}_bindTouch(){this.settings.enableTouch&&this._bindDragEvents("touchstart","touchmove","touchend",(t=>({x:t.touches[0].clientX,y:t.touches[0].clientY})))}_onTouchStart(t){if(1===t.touches.length){const e=t.touches[0];this.touch.x=e.clientX,this.touch.y=e.clientY,this.touch.active=!0}}_onTouchMove(t){if(1===t.touches.length&&this.touch.active){const e=t.touches[0],s=e.clientX-this.touch.x,i=e.clientY-this.touch.y;this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(i*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(s*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=i*this.settings.speed*.1,this.velocity.y=s*this.settings.speed*.1),this.touch.x=e.clientX,this.touch.y=e.clientY,t.preventDefault&&t.preventDefault()}}_bindMouse(){this.settings.enableDrag&&(this._bindDragEvents("mousedown","mousemove","mouseup",(t=>({x:t.clientX,y:t.clientY}))),this.canvas.addEventListener("mouseleave",(()=>{this._applyDragEasing()})))}_applyDragEasing(){const t=()=>{this.velocity.x*=.97,this.velocity.y*=.97,Math.abs(this.velocity.x)<.005&&(this.velocity.x=0),Math.abs(this.velocity.y)<.005&&(this.velocity.y=0),0===this.velocity.x&&0===this.velocity.y||requestAnimationFrame(t)};t()}_bindOrientation(){if(!this.settings.enableOrientation)return;let t=0;window.addEventListener("deviceorientation",(e=>{const s=Date.now();if(s-t<100)return;t=s;const{gamma:i=0,beta:n=0}=e;this.velocity.x=5e-4*i,this.velocity.y=5e-4*n}))}_handleOrientation(t){const{beta:e,gamma:s}=t;null!==e&&null!==s&&(this.velocity.x=5e-4*s,this.velocity.y=5e-4*e)}_attachInteraction(){this.settings.enableClick&&this.canvas.addEventListener("click",this._onCanvasClick.bind(this)),this.canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this)),this.canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this))}_onCanvasClick(t){const e=this._getPointer(t),s=this._getTagAt(e);s&&this.settings.clickEffect&&(s._scale=1.1*this.settings.hoverScale,setTimeout((()=>{s._scale=this.settings.hoverScale}),200));const i=e.x-this.center.x,n=e.y-this.center.y,a=Math.sqrt(i*i+n*n),o=this.settings.maxVelocity>0?.2*this.settings.maxVelocity:.1*this.settings.speed;this.velocity.x=-n/a*o||.1*this.settings.speed,this.velocity.y=-i/a*o||.1*this.settings.speed}_onCanvasMouseMove(t){const e=this._getPointer(t),s=this._getTagAt(e);if(s&&s.index!==this._hoveredIndex){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((e=>e(t)))}this._hoveredIndex=s.index,this.settings.hoverEffect&&(s._scale=this.settings.hoverScale,s._color=this.settings.hoverColor||s.color,s._opacity=this.settings.hoverOpacity),this._events.tagHover.forEach((t=>t(s)))}else if(!s&&null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((e=>e(t))),this._hoveredIndex=null}}_onCanvasMouseLeave(){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((e=>e(t))),this._hoveredIndex=null}}_getPointer(t){const e=this.canvas.getBoundingClientRect();return{x:t.clientX-e.left,y:t.clientY-e.top}}_getTagAt(t){for(let e=this.tags.length-1;e>=0;e--){const s=this.tags[e],i=s._screen;if(!i)continue;const n=t.x-i.x,a=t.y-i.y;if(Math.abs(n)<=i.width/2&&Math.abs(a)<=i.height/2)return s}return null}_positionTags(){if(!this.tags.length)return;const e=this.settings.radius,s=this.tags.length;switch(this.settings.shape||t){case"cube":const t=Math.ceil(Math.cbrt(s));this.tags.forEach(((s,i)=>{const n=i%t-t/2+.5,a=Math.floor(i/t)%t-t/2+.5,o=Math.floor(i/(t*t))-t/2+.5;s.x=n*(e/t)*2,s.y=a*(e/t)*2,s.z=o*(e/t)*2}));break;case"plane":const i=Math.ceil(Math.sqrt(s)),n=Math.ceil(s/i),a=2*e/n,o=2*e/i;this.tags.forEach(((t,s)=>{const i=Math.floor(s/n),h=s%n;t.x=h*a-e+a/2,t.y=i*o-e+o/2,t.z=0}));break;case"pyramid":const h=Math.ceil(Math.sqrt(s));let c=0;for(let t=0;t<h;t++){const i=h-t,n=t/h*e*2-e;for(let a=0;a<i&&c<s;a++,c++){const s=a/i*2*Math.PI,o=e*(h-t)/h;this.tags[c].x=o*Math.cos(s),this.tags[c].y=n,this.tags[c].z=o*Math.sin(s)}}break;case"helix":const r=2,l=2*e/s;this.tags.forEach(((t,i)=>{const n=i/s*2*Math.PI*r,a=i*l-e;t.x=e*Math.cos(n),t.y=a,t.z=e*Math.sin(n)}));break;case"ring":this.tags.forEach(((t,i)=>{const n=i/s*2*Math.PI;t.x=e*Math.cos(n),t.y=0,t.z=e*Math.sin(n)}));break;case"verticalRing":this.tags.forEach(((t,i)=>{const n=i/s*2*Math.PI;t.x=0,t.y=e*Math.sin(n),t.z=e*Math.cos(n)}));break;case"cylinder":const v=2*e/s,d=Math.ceil(Math.sqrt(s));this.tags.forEach(((t,s)=>{const i=Math.floor(s/d),n=s%d*(2*Math.PI/d),a=i*v-e;t.x=e*Math.cos(n),t.y=a,t.z=e*Math.sin(n)}));break;default:this.tags.forEach(((t,i)=>{const n=2*i/(s-1)-1,a=Math.acos(n),o=Math.sqrt(s*Math.PI)*a;t.x=e*Math.sin(a)*Math.cos(o),t.y=e*Math.sin(a)*Math.sin(o),t.z=e*Math.cos(a)}))}}_draw(){const{ctx:t,canvas:e,center:s}=this;t.clearRect(0,0,e.width,e.height);const i=[...this.tags].filter((t=>t&&"string"==typeof t.text&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z)).sort(((t,e)=>e.z-t.z));for(const e of i)try{const i=2*s.x+e.z,n=i>0?2*s.x/i:1,a=isFinite(e.x*n+s.x)?e.x*n+s.x:s.x,o=isFinite(e.y*n+s.y)?e.y*n+s.y:s.y,h=isFinite((e.fontSize||15)*n*(e._scale||1))?(e.fontSize||15)*n*(e._scale||1):15,c=e.text,r=void 0!==e._opacity?e._opacity:1;t.globalAlpha=r,t.fillStyle=e._color||e.color||"#fff",t.font=`${this.settings.customFontWeight} ${h}px ${this.settings.customFont}`;const l=t.measureText(c);e._screen={x:a,y:o,width:l.width,height:h},t.fillText(c,a-l.width/2,o+h/2)}catch(t){console.error("Error drawing tag:",e,t)}}_animate(){if(!this.settings.paused){if(this.settings.autoSpin?0===this.settings.maxVelocity&&0===this.velocity.x&&0===this.velocity.y&&(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed):0===this.velocity.x&&this.velocity.y,0!==this.velocity.x||0!==this.velocity.y){this.settings.enableEasing?(this.rotation.x+=(this.velocity.x-this.rotation.x)*this.settings.easing,this.rotation.y+=(this.velocity.y-this.rotation.y)*this.settings.easing):(this.rotation.x+=this.velocity.x,this.rotation.y+=this.velocity.y);const e=this.settings.shape||t;"ring"===e||"helix"===e?this.rotation.x=0:"verticalRing"===e&&(this.rotation.y=0);const s=Math.cos(this.rotation.y),i=Math.sin(this.rotation.y),n=Math.cos(this.rotation.x),a=Math.sin(this.rotation.x);this.tags.forEach((t=>{let{x:e,y:o,z:h}=t,c=e*s-h*i,r=e*i+h*s,l=o*n-r*a;r=o*a+r*n,t.x=c,t.y=l,t.z=r}))}this._draw(),this.animFrame=requestAnimationFrame(this._animate.bind(this))}}pause(){this.settings.paused=!0,this.animFrame&&cancelAnimationFrame(this.animFrame),this._events.pause?.forEach((t=>t()))}resume(){this.settings.paused=!1,this._animate(),this._events.resume?.forEach((t=>t()))}destroy(){this.pause(),window.removeEventListener("resize",this._resize),this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch),this.canvas.removeEventListener("mousedown",this._bindMouse),this.canvas.removeEventListener("mousemove",this._onCanvasMouseMove),this.canvas.removeEventListener("mouseup",this._bindMouse),this.canvas.removeEventListener("mouseleave",this._onCanvasMouseLeave),this.canvas.removeEventListener("click",this._onCanvasClick),window.removeEventListener("deviceorientation",this._orientationHandler),this.canvas.parentNode&&this.canvas.replaceWith(this.canvas.cloneNode(!0)),this.tags=[]}}}));
//# sourceMappingURL=orbity.min.js.map
