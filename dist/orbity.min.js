!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Orbity=s()}(this,function(){"use strict";const t="sphere",s={Snappy:{easeIn:.2,friction:.9},Smooth:{easeIn:.1,friction:.95},Marathon:{easeIn:.05,friction:.99}};return class{constructor(s,e={}){this.canvas=s,this.ctx=s.getContext("2d"),this.tags=[],this.settings=Object.assign({radius:150,speed:1,easing:.1,enableEasing:!0,paused:!1,enableTouch:!0,enableOrientation:!1,maxVelocity:.5,shape:t,enableDrag:!0,enableClick:!0,autoSpin:!0,hoverEffect:!0,clickEffect:!0,hoverScale:1.2,hoverColor:"#ff0",hoverOpacity:1,customFont:"sans-serif",customFontWeight:"normal",easingProfile:"Smooth",customEaseIn:.1,customFriction:.95,autoEasing:!0,minVelocityThreshold:.005,dragSensitivity:2},e),this.rotation={x:0,y:0},this.velocity={x:0,y:0},this.settings.autoSpin&&(this.velocity.x=this.settings.speed,this.velocity.y=this.settings.speed),this.touch={x:0,y:0,active:!1},this.animFrame=null,this._events={tagClick:[],tagHover:[],tagLeave:[]},this._hoveredIndex=null,this.undoStack=[],this.redoStack=[],this.settings.easing=Math.min(Math.max(this.settings.easing,.01),.5),this.settings.speed=Math.min(Math.max(this.settings.speed,.001),5),this._orientationHandler=this._handleOrientation.bind(this),this._touchStartHandler=this._onTouchStart.bind(this),this._touchMoveHandler=this._onTouchMove.bind(this),this._mouseMoveHandler=this._onCanvasMouseMove.bind(this),this._mouseLeaveHandler=this._onCanvasMouseLeave.bind(this),this._clickHandler=this._onCanvasClick.bind(this),this._keyboardHandler=this._onKeyboard.bind(this),this._init()}_throttle(t,s){let e,i;return function(...a){const n=this;i?(clearTimeout(e),e=setTimeout(function(){Date.now()-i>=s&&(t.apply(n,a),i=Date.now())},s-(Date.now()-i))):(t.apply(n,a),i=Date.now())}}_init(){this._resize=this._throttle(this._resize.bind(this),200),this._onCanvasMouseMove=this._throttle(this._onCanvasMouseMove.bind(this),50),window.addEventListener("resize",this._resize),this._bindTouch(),this._bindMouse(),this._bindOrientation(),this._attachInteraction(),this.canvas.setAttribute("role","region"),this.canvas.setAttribute("aria-label","3D tag cloud visualization"),this.canvas.setAttribute("tabindex","0"),this.canvas.addEventListener("keydown",this._keyboardHandler),this._resize(),this._positionTags(),this._animate()}_resize(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.center={x:this.canvas.width/2,y:this.canvas.height/2},this._positionTags()}setTags(t){this.tags=t.map((t,s)=>({...t,angleX:2*Math.random()*Math.PI,angleY:Math.random()*Math.PI,index:s,_screen:{},_scale:1,_color:t.color,_opacity:1,_img:t.imageUrl?null:void 0,_svg:t.svg?null:void 0})),this._reindexTags(),this._positionTags(),this._draw()}_getRandomAngle(){return 2*Math.random()*Math.PI}addTag(t){if(!this._validateTag(t))return;const s={...t,angleX:this._getRandomAngle(),angleY:this._getRandomAngle(),index:this.tags.length,_screen:{},_scale:1,_color:t.color,_opacity:1,_img:t.imageUrl?null:void 0,_svg:t.svg?null:void 0};this.tags.push(s),this.undoStack.push({action:"add",tag:{...s}}),this.redoStack=[],this._reindexTags(),this._positionTags()}removeTag(t){if(t<0||t>=this.tags.length)return;const s=this.tags.splice(t,1)[0];this.undoStack.push({action:"remove",tag:{...s},index:t}),this.redoStack=[],this._reindexTags(),this._positionTags()}updateTag(t,s){if(!this.tags[t])return void console.error(`Tag at index ${t} does not exist.`);const e={...this.tags[t]};Object.assign(this.tags[t],s,{_scale:1,_color:s.color||this.tags[t].color,_opacity:1}),this.undoStack.push({action:"update",oldData:e,newData:{...this.tags[t]}}),this.redoStack=[],this._reindexTags(),this._positionTags()}undo(){if(0===this.undoStack.length)return;const t=this.undoStack.pop();switch(this.redoStack.push(t),t.action){case"add":this.tags.pop();break;case"remove":this.tags.splice(t.index,0,{...t.tag});break;case"update":Object.assign(this.tags[t.oldData.index],t.oldData)}this._reindexTags(),this._positionTags()}redo(){if(0===this.redoStack.length)return;const t=this.redoStack.pop();switch(this.undoStack.push(t),t.action){case"add":this.tags.push({...t.tag});break;case"remove":this.tags.splice(t.index,1);break;case"update":Object.assign(this.tags[t.newData.index],t.newData)}this._reindexTags(),this._positionTags()}clearTags(){this.tags=[],this._reindexTags(),this._positionTags()}updateOptions(s){if(this.settings={...this.settings,...s},void 0!==s.easing&&("number"!=typeof s.easing?(console.error("Invalid easing: must be a number"),this.settings.easing=.1):this.settings.easing=s.easing),void 0!==s.speed&&("number"!=typeof s.speed?(console.error("Invalid speed: must be a "),this.settings.speed=1):this.settings.speed=s.speed),void 0!==s.radius&&("number"!=typeof s.radius||s.radius<=0)&&(console.error("Invalid radius: must be a positive number."),this.settings.radius=150),void 0!==s.shape){const e=["sphere","cube","plane","helix","ring","verticalRing","cylinder","pyramid","torus"];e.includes(s.shape)||(console.error(`Invalid shape: must be one of ${e.join(", ")}.`),this.settings.shape=t)}void 0!==s.maxVelocity&&("number"!=typeof s.maxVelocity||s.maxVelocity<0)&&(console.error("Invalid maxVelocity: must be a non-negative number."),this.settings.maxVelocity=.5),void 0===s.radius&&void 0===s.shape||this._positionTags(),void 0!==s.enableTouch&&(s.enableTouch?this._bindTouch():(this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch))),void 0!==s.enableOrientation&&(s.enableOrientation?this._bindOrientation():window.removeEventListener("deviceorientation",this._orientationHandler)),void 0!==s.enableClick&&(s.enableClick?this.canvas.addEventListener("click",this._clickHandler):this.canvas.removeEventListener("click",this._clickHandler)),void 0!==s.paused&&(s.paused?this.pause():this.resume()),void 0!==s.easingProfile&&this.setEasingProfile(s.easingProfile),void 0!==s.autoEasing&&this.toggleAutoEasing(s.autoEasing),void 0!==s.customEaseIn&&(this.settings.customEaseIn=s.customEaseIn),void 0!==s.customFriction&&(this.settings.customFriction=s.customFriction),void 0!==s.minVelocityThreshold&&(this.settings.minVelocityThreshold=s.minVelocityThreshold)}_validateTag(t){return t.text&&"string"==typeof t.text?!(!t.color||!/^#[0-9A-F]{6}$/i.test(t.color))||(console.error("Invalid tag: 'color' must be a valid hex color code."),!1):(console.error("Invalid tag: 'text' is required and must be a string."),!1)}_bindDragEvents(t,s,e,i){this._dragHandlers||(this._dragHandlers={}),this._dragHandlers[t]&&(this.canvas.removeEventListener(t,this._dragHandlers[t]),this.canvas.removeEventListener(s,this._dragHandlers[s]),this.canvas.removeEventListener(e,this._dragHandlers[e]),this.canvas.removeEventListener("mouseleave",this._dragHandlers.mouseleave),this._dragHandlers.windowMouseUp&&window.removeEventListener("mouseup",this._dragHandlers.windowMouseUp));let a=!1,n=0,o=0;const h=t=>{if(!this.settings.enableDrag)return;a=!0;const s=i(t);n=s.x,o=s.y,0===this.velocity.x&&0===this.velocity.y&&(this.velocity.x=this.settings.speed,this.velocity.y=this.settings.speed),"mouseup"===e&&(window.addEventListener("mouseup",c),this._dragHandlers.windowMouseUp=c)},r=t=>{if(!this.settings.enableDrag||!a)return;const s=i(t),e=(s.x-n)*(this.settings.dragSensitivity||1),h=(s.y-o)*(this.settings.dragSensitivity||1);this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(h*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(e*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=h*this.settings.speed,this.velocity.y=e*this.settings.speed),n=s.x,o=s.y,t.preventDefault&&t.preventDefault()},c=()=>{this.settings.enableDrag&&(a=!1,this._applyDragEasing())},l=()=>{this.settings.enableDrag&&a&&(a=!1,this._applyDragEasing())};this.canvas.addEventListener(t,h),this.canvas.addEventListener(s,r,{passive:!1}),this.canvas.addEventListener(e,c),this.canvas.addEventListener("mouseleave",l),this._dragHandlers[t]=h,this._dragHandlers[s]=r,this._dragHandlers[e]=c,this._dragHandlers.mouseleave=l}_bindTouch(){this.settings.enableTouch&&this._bindDragEvents("touchstart","touchmove","touchend",t=>({x:t.touches[0].clientX,y:t.touches[0].clientY}))}_onTouchStart(t){if(1===t.touches.length){const s=t.touches[0];this.touch.x=s.clientX,this.touch.y=s.clientY,this.touch.active=!0}}_onTouchMove(t){if(1===t.touches.length&&this.touch.active){const s=t.touches[0],e=(s.clientX-this.touch.x)*(this.settings.dragSensitivity||1),i=(s.clientY-this.touch.y)*(this.settings.dragSensitivity||1);this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(i*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(e*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=i*this.settings.speed*.1,this.velocity.y=e*this.settings.speed*.1),this.touch.x=s.clientX,this.touch.y=s.clientY,t.preventDefault&&t.preventDefault()}}_bindMouse(){this._bindDragEvents("mousedown","mousemove","mouseup",t=>({x:t.clientX,y:t.clientY}))}setEasingProfile(t){if("Custom"!==t)if(s[t]){this.settings.easingProfile=t;const{easeIn:e,friction:i}=s[t];this.settings.customEaseIn=e,this.settings.customFriction=i}else console.error(`Invalid easing profile: ${t}`);else this.settings.easingProfile=t}toggleAutoEasing(t){this.settings.autoEasing=t}_applyDragEasing(){const{customFriction:t,minVelocityThreshold:s}=this.settings,e=()=>{this.velocity.x*=t,this.velocity.y*=t,Math.abs(this.velocity.x)<s&&(this.velocity.x=0),Math.abs(this.velocity.y)<s&&(this.velocity.y=0),0===this.velocity.x&&0===this.velocity.y||requestAnimationFrame(e)};e()}_bindOrientation(){if(!this.settings.enableOrientation)return;let t=0;window.addEventListener("deviceorientation",s=>{const e=Date.now();if(e-t<100)return;t=e;const{gamma:i=0,beta:a=0}=s;this.velocity.x=5e-4*i,this.velocity.y=5e-4*a})}_handleOrientation(t){const{beta:s,gamma:e}=t;null!==s&&null!==e&&(this.velocity.x=5e-4*e,this.velocity.y=5e-4*s)}_attachInteraction(){this.settings.enableClick&&this.canvas.addEventListener("click",this._onCanvasClick.bind(this)),this.canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this)),this.canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this))}_onCanvasClick(t){const s=this._getPointer(t),e=this._getTagAt(s);e&&this.settings.clickEffect&&(e._scale=1.1*this.settings.hoverScale,setTimeout(()=>{e._scale=this.settings.hoverScale},200));const i=s.x-this.center.x,a=s.y-this.center.y,n=Math.sqrt(i*i+a*a),o=this.settings.maxVelocity>0?.2*this.settings.maxVelocity:.1*this.settings.speed;this.velocity.x=-a/n*o||.1*this.settings.speed,this.velocity.y=-i/n*o||.1*this.settings.speed}_onCanvasMouseMove(t){const s=this._getPointer(t),e=this._getTagAt(s);if(e&&e.index!==this._hoveredIndex){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach(s=>s(t))}this._hoveredIndex=e.index,this.settings.hoverEffect&&(e._scale=this.settings.hoverScale,e._color=this.settings.hoverColor||e.color,e._opacity=this.settings.hoverOpacity),this._events.tagHover.forEach(t=>t(e))}else if(!e&&null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach(s=>s(t)),this._hoveredIndex=null}}_onCanvasMouseLeave(){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach(s=>s(t)),this._hoveredIndex=null}}_onKeyboard(t){switch(t.key){case"ArrowLeft":this.rotation.y-=.1,t.preventDefault();break;case"ArrowRight":this.rotation.y+=.1,t.preventDefault();break;case"ArrowUp":this.rotation.x-=.1,t.preventDefault();break;case"ArrowDown":this.rotation.x+=.1,t.preventDefault();break;case"Home":case"End":this.rotation.x=0,this.rotation.y=0,t.preventDefault();break;case" ":case"Spacebar":this.settings.paused?this.resume():this.pause(),t.preventDefault()}}_getPointer(t){const s=this.canvas.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}_getTagAt(t){for(let s=this.tags.length-1;s>=0;s--){const e=this.tags[s],i=e._screen;if(!i)continue;const a=t.x-i.x,n=t.y-i.y;if(Math.abs(a)<=i.width/2&&Math.abs(n)<=i.height/2)return e}return null}_positionTags(){if(!this.tags.length)return;const s=this.settings.radius,e=this.tags.length;switch(this.settings.shape||t){case"torus":const t=this.settings.majorRadius||.6*s,i=this.settings.minorRadius||.3*s,a=Math.ceil(Math.sqrt(e)),n=Math.ceil(e/a);this.tags.forEach((s,e)=>{const o=e%a*(2*Math.PI/a),h=Math.floor(e/a)*(2*Math.PI/n),r=(t+i*Math.cos(h))*Math.cos(o),c=(t+i*Math.cos(h))*Math.sin(o),l=i*Math.sin(h);s.x=r,s.y=c,s.z=l});break;case"cube":const o=Math.ceil(Math.cbrt(e)),h=.1;let r=0;this.tags.forEach(t=>{let e,i,a;do{e=r%o-o/2+.5,i=Math.floor(r/o)%o-o/2+.5,a=Math.floor(r/(o*o))-o/2+.5,r++}while(Math.abs(e)<h&&Math.abs(i)<h&&Math.abs(a)<h);t.x=e*(s/o)*2,t.y=i*(s/o)*2,t.z=a*(s/o)*2});break;case"pyramid":const c=Math.ceil(Math.sqrt(e));let l=0;for(let t=0;t<c;t++){const i=c-t,a=t/c*s*2-s;for(let n=0;n<i&&l<e;n++,l++){const e=n/i*2*Math.PI,o=s*(c-t)/c;this.tags[l].x=o*Math.cos(e),this.tags[l].y=a,this.tags[l].z=o*Math.sin(e)}}break;case"helix":const d=2,g=2*s/e;this.tags.forEach((t,i)=>{const a=i/e*2*Math.PI*d,n=i*g-s;t.x=s*Math.cos(a),t.y=n,t.z=s*Math.sin(a)});break;case"ring":this.tags.forEach((t,i)=>{const a=i/e*2*Math.PI;t.x=s*Math.cos(a),t.y=0,t.z=s*Math.sin(a)});break;case"verticalRing":this.tags.forEach((t,i)=>{const a=i/e*2*Math.PI;t.x=0,t.y=s*Math.sin(a),t.z=s*Math.cos(a)});break;case"cylinder":const v=2*s/Math.ceil(e/10),u=Math.ceil(Math.sqrt(e));this.tags.forEach((t,e)=>{const i=Math.floor(e/u),a=e%u*(2*Math.PI/u),n=i*v-s;t.x=s*Math.cos(a),t.y=n,t.z=s*Math.sin(a)});break;case"plane":const m=Math.ceil(Math.sqrt(e)),_=Math.ceil(e/m),y=2*s/(m-1||1),p=2*s/(_-1||1);this.tags.forEach((t,e)=>{const i=e%m,a=Math.floor(e/m);t.x=i*y-s,t.y=0,t.z=a*p-s});break;default:const x=(1+Math.sqrt(5))/2,f=2*Math.PI*x;this.tags.forEach((t,i)=>{const a=i/e,n=Math.acos(1-2*a),o=f*i;t.x=s*Math.sin(n)*Math.cos(o),t.y=s*Math.sin(n)*Math.sin(o),t.z=s*Math.cos(n)})}}_draw(){const{ctx:t,canvas:s,center:e}=this;t.clearRect(0,0,s.width,s.height);const i=[...this.tags].filter(t=>t&&("string"==typeof t.text||t.imageUrl||t.svg)&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z).sort((t,s)=>s.z-t.z);for(const s of i)try{const i=2*e.x+s.z,a=i>0?2*e.x/i:1,n=isFinite(s.x*a+e.x)?s.x*a+e.x:e.x,o=isFinite(s.y*a+e.y)?s.y*a+e.y:e.y,h=isFinite((s.fontSize||15)*a*(s._scale||1))?(s.fontSize||15)*a*(s._scale||1):15,r=2*e.x,c=2*-e.x,l=(s.z-c)/(r-c),d=Math.max(.2,Math.min(1,l));if(t.globalAlpha=d,this._focusedIndex===s.index&&(t.save(),t.strokeStyle="#ffc845",t.lineWidth=3,t.beginPath(),t.arc(n,o,h,0,2*Math.PI),t.stroke(),t.restore()),s.imageUrl&&(s._img||(s._img=new window.Image,s._img.src=s.imageUrl,s._img.onload=()=>this._draw()),s._img.complete&&s._img.naturalWidth)){t.drawImage(s._img,n-h/2,o-h/2,h,h),s._screen={x:n,y:o,width:h,height:h};continue}if(s.svg){if(!s._svg){const t=new window.Image,e=new Blob([s.svg],{type:"image/svg+xml"});s._svgUrl=URL.createObjectURL(e),t.src=s._svgUrl,t.onload=()=>{s._svg=t,this._draw()}}if(s._svg&&s._svg.complete&&s._svg.naturalWidth){t.drawImage(s._svg,n-h/2,o-h/2,h,h),s._screen={x:n,y:o,width:h,height:h};continue}}if(s.text){t.fillStyle=s._color||s.color||"#fff",t.font=`${this.settings.customFontWeight} ${h}px ${this.settings.customFont}`;const e=t.measureText(s.text);s._screen={x:n,y:o,width:e.width,height:h},t.fillText(s.text,n-e.width/2,o+h/2)}}catch(t){console.error("Error drawing tag:",s,t)}}_animate(){if(!this.settings.paused){if(this.settings.autoSpin&&!this.settings.paused&&(this.settings.autoEasing?(this.velocity.x+=(this.settings.speed-this.velocity.x)*this.settings.customEaseIn,this.velocity.y+=(this.settings.speed-this.velocity.y)*this.settings.customEaseIn):(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed),this.settings.maxVelocity>0&&(this.velocity.x=Math.max(-this.settings.maxVelocity,Math.min(this.velocity.x,this.settings.maxVelocity)),this.velocity.y=Math.max(-this.settings.maxVelocity,Math.min(this.velocity.y,this.settings.maxVelocity)))),0!==this.velocity.x||0!==this.velocity.y){this.settings.autoEasing?(this.rotation.x+=(this.velocity.x-this.rotation.x)*this.settings.easing,this.rotation.y+=(this.velocity.y-this.rotation.y)*this.settings.easing):(this.rotation.x+=this.velocity.x,this.rotation.y+=this.velocity.y);const s=this.settings.shape||t;"ring"===s||"helix"===s?this.rotation.x=0:"verticalRing"===s&&(this.rotation.y=0);const e=Math.cos(this.rotation.y),i=Math.sin(this.rotation.y),a=Math.cos(this.rotation.x),n=Math.sin(this.rotation.x);this.tags.forEach(t=>{let{x:s,y:o,z:h}=t,r=s*e-h*i,c=s*i+h*e,l=o*a-c*n;c=o*n+c*a,t.x=r,t.y=l,t.z=c})}this._draw(),this.animFrame=requestAnimationFrame(this._animate.bind(this))}}pause(){this.settings.paused=!0,this.animFrame&&(cancelAnimationFrame(this.animFrame),this.animFrame=null),this._events.pause?.forEach(t=>t())}resume(){this.settings.paused&&(this.settings.paused=!1,this._animate(),this._events.resume?.forEach(t=>t()))}destroy(){this.pause(),window.removeEventListener("resize",this._resize),this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch),this.canvas.removeEventListener("mousedown",this._bindMouse),this.canvas.removeEventListener("mousemove",this._onCanvasMouseMove),this.canvas.removeEventListener("mouseup",this._bindMouse),this.canvas.removeEventListener("mouseleave",this._onCanvasMouseLeave),this.canvas.removeEventListener("click",this._onCanvasClick),window.removeEventListener("deviceorientation",this._orientationHandler),this.canvas.removeEventListener("keydown",this._keyboardHandler),this.canvas.parentNode&&this.canvas.replaceWith(this.canvas.cloneNode(!0)),this.tags=[]}_reindexTags(){this.tags.forEach((t,s)=>{t.index=s})}}});
//# sourceMappingURL=orbity.min.js.map
