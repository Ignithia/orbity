!function(t,s){"object"==typeof exports&&"undefined"!=typeof module?module.exports=s():"function"==typeof define&&define.amd?define(s):(t="undefined"!=typeof globalThis?globalThis:t||self).Orbity=s()}(this,(function(){"use strict";const t="sphere";return class{constructor(s,e={}){this.canvas=s,this.ctx=s.getContext("2d"),this.tags=[],this.settings=Object.assign({radius:150,speed:1,easing:.1,enableEasing:!0,paused:!1,enableTouch:!0,enableOrientation:!1,maxVelocity:.5,shape:t,enableDrag:!0,enableClick:!0,autoSpin:!0,hoverEffect:!0,clickEffect:!0,hoverScale:1.2,hoverColor:"#ff0",hoverOpacity:1,customFont:"sans-serif",customFontWeight:"normal"},e),this.rotation={x:0,y:0},this.velocity={x:0,y:0},this.settings.autoSpin&&(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed),this.touch={x:0,y:0,active:!1},this.animFrame=null,this._events={tagClick:[],tagHover:[],tagLeave:[]},this._hoveredIndex=null,this.undoStack=[],this.redoStack=[],this.settings.easing=Math.min(Math.max(this.settings.easing,.01),.5),this.settings.speed=Math.min(Math.max(this.settings.speed,.1),5),this._orientationHandler=this._handleOrientation.bind(this),this._touchStartHandler=this._onTouchStart.bind(this),this._touchMoveHandler=this._onTouchMove.bind(this),this._mouseMoveHandler=this._onCanvasMouseMove.bind(this),this._mouseLeaveHandler=this._onCanvasMouseLeave.bind(this),this._clickHandler=this._onCanvasClick.bind(this),this._init()}_throttle(t,s){let e,i;return function(...a){const n=this;i?(clearTimeout(e),e=setTimeout((function(){Date.now()-i>=s&&(t.apply(n,a),i=Date.now())}),s-(Date.now()-i))):(t.apply(n,a),i=Date.now())}}_init(){this._resize=this._throttle(this._resize.bind(this),200),this._onCanvasMouseMove=this._throttle(this._onCanvasMouseMove.bind(this),50),window.addEventListener("resize",this._resize),this._bindTouch(),this._bindMouse(),this._bindOrientation(),this._attachInteraction(),this.canvas.setAttribute("role","img"),this.canvas.setAttribute("aria-label","3D tag cloud visualization"),this._resize(),this._positionTags(),this._animate()}_resize(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.center={x:this.canvas.width/2,y:this.canvas.height/2},this._positionTags()}setTags(t){this.tags=t.map(((t,s)=>({...t,angleX:2*Math.random()*Math.PI,angleY:Math.random()*Math.PI,index:s,_screen:{},_scale:1,_color:t.color,_opacity:1}))),this._positionTags(),this._draw()}_getRandomAngle(){return 2*Math.random()*Math.PI}addTag(t){if(!this._validateTag(t))return;const s={...t,angleX:this._getRandomAngle(),angleY:this._getRandomAngle(),index:this.tags.length,_screen:{},_scale:1,_color:t.color,_opacity:1};this.tags.push(s),this.undoStack.push({action:"add",tag:s}),this.redoStack=[],this._positionTags()}removeTag(t){if(t<0||t>=this.tags.length)return;const s=this.tags.splice(t,1)[0];this.undoStack.push({action:"remove",tag:s,index:t}),this.redoStack=[],this._positionTags()}updateTag(t,s){if(!this.tags[t])return void console.error(`Tag at index ${t} does not exist.`);const e={...this.tags[t]};Object.assign(this.tags[t],s,{_scale:1,_color:s.color||this.tags[t].color,_opacity:1}),this.undoStack.push({action:"update",oldData:e,newData:{...this.tags[t]}}),this.redoStack=[],this._positionTags()}undo(){if(0===this.undoStack.length)return;const t=this.undoStack.pop();switch(this.redoStack.push(t),t.action){case"add":this.tags.pop();break;case"remove":this.tags.splice(t.index,0,t.tag);break;case"update":Object.assign(this.tags[t.oldData.index],t.oldData)}this._positionTags()}redo(){if(0===this.redoStack.length)return;const t=this.redoStack.pop();switch(this.undoStack.push(t),t.action){case"add":this.tags.push(t.tag);break;case"remove":this.tags.splice(t.index,1);break;case"update":Object.assign(this.tags[t.newData.index],t.newData)}this._positionTags()}clearTags(){this.tags=[]}updateOptions(s){if(this.settings={...this.settings,...s},void 0!==s.easing&&("number"!=typeof s.easing?(console.error("Invalid easing: must be a number"),this.settings.easing=.1):this.settings.easing=s.easing),void 0!==s.speed&&("number"!=typeof s.speed?(console.error("Invalid speed: must be a "),this.settings.speed=1):this.settings.speed=s.speed),void 0!==s.radius&&("number"!=typeof s.radius||s.radius<=0)&&(console.error("Invalid radius: must be a positive number."),this.settings.radius=150),void 0!==s.shape){const e=["sphere","cube","plane","helix","ring","verticalRing","cylinder","pyramid","torus"];e.includes(s.shape)||(console.error(`Invalid shape: must be one of ${e.join(", ")}.`),this.settings.shape=t)}void 0!==s.maxVelocity&&("number"!=typeof s.maxVelocity||s.maxVelocity<0)&&(console.error("Invalid maxVelocity: must be a non-negative number."),this.settings.maxVelocity=.5),void 0===s.radius&&void 0===s.shape||this._positionTags(),void 0!==s.enableTouch&&(s.enableTouch?this._bindTouch():(this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch))),void 0!==s.enableOrientation&&(s.enableOrientation?this._bindOrientation():window.removeEventListener("deviceorientation",this._orientationHandler)),void 0!==s.enableClick&&(s.enableClick?this.canvas.addEventListener("click",this._clickHandler):this.canvas.removeEventListener("click",this._clickHandler)),void 0!==s.paused&&(s.paused?this.pause():this.resume())}_validateTag(t){return t.text&&"string"==typeof t.text?!(!t.color||!/^#[0-9A-F]{6}$/i.test(t.color))||(console.error("Invalid tag: 'color' must be a valid hex color code."),!1):(console.error("Invalid tag: 'text' is required and must be a string."),!1)}_bindDragEvents(t,s,e,i){let a=!1,n=0,o=0;this.canvas.addEventListener(t,(t=>{a=!0;const s=i(t);n=s.x,o=s.y,0===this.velocity.x&&0===this.velocity.y&&(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed)})),this.canvas.addEventListener(s,(t=>{if(!a)return;const s=i(t),e=s.x-n,h=s.y-o;this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(h*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(e*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=h*this.settings.speed*.1,this.velocity.y=e*this.settings.speed*.1),n=s.x,o=s.y,t.preventDefault&&t.preventDefault()}),{passive:!1}),this.canvas.addEventListener(e,(()=>{a=!1,this._applyDragEasing()})),this.canvas.addEventListener("mouseleave",(()=>{a&&(a=!1,this._applyDragEasing())}))}_bindTouch(){this.settings.enableTouch&&this._bindDragEvents("touchstart","touchmove","touchend",(t=>({x:t.touches[0].clientX,y:t.touches[0].clientY})))}_onTouchStart(t){if(1===t.touches.length){const s=t.touches[0];this.touch.x=s.clientX,this.touch.y=s.clientY,this.touch.active=!0}}_onTouchMove(t){if(1===t.touches.length&&this.touch.active){const s=t.touches[0],e=s.clientX-this.touch.x,i=s.clientY-this.touch.y;this.settings.maxVelocity>0?(this.velocity.x=Math.min(Math.max(i*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity),this.velocity.y=Math.min(Math.max(e*this.settings.speed,-this.settings.maxVelocity),this.settings.maxVelocity)):(this.velocity.x=i*this.settings.speed*.1,this.velocity.y=e*this.settings.speed*.1),this.touch.x=s.clientX,this.touch.y=s.clientY,t.preventDefault&&t.preventDefault()}}_bindMouse(){this.settings.enableDrag&&(this._bindDragEvents("mousedown","mousemove","mouseup",(t=>({x:t.clientX,y:t.clientY}))),this.canvas.addEventListener("mouseleave",(()=>{this._applyDragEasing()})))}_applyDragEasing(){const t=()=>{this.velocity.x*=.97,this.velocity.y*=.97,Math.abs(this.velocity.x)<.005&&(this.velocity.x=0),Math.abs(this.velocity.y)<.005&&(this.velocity.y=0),0===this.velocity.x&&0===this.velocity.y||requestAnimationFrame(t)};t()}_bindOrientation(){if(!this.settings.enableOrientation)return;let t=0;window.addEventListener("deviceorientation",(s=>{const e=Date.now();if(e-t<100)return;t=e;const{gamma:i=0,beta:a=0}=s;this.velocity.x=5e-4*i,this.velocity.y=5e-4*a}))}_handleOrientation(t){const{beta:s,gamma:e}=t;null!==s&&null!==e&&(this.velocity.x=5e-4*e,this.velocity.y=5e-4*s)}_attachInteraction(){this.settings.enableClick&&this.canvas.addEventListener("click",this._onCanvasClick.bind(this)),this.canvas.addEventListener("mousemove",this._onCanvasMouseMove.bind(this)),this.canvas.addEventListener("mouseleave",this._onCanvasMouseLeave.bind(this))}_onCanvasClick(t){const s=this._getPointer(t),e=this._getTagAt(s);e&&this.settings.clickEffect&&(e._scale=1.1*this.settings.hoverScale,setTimeout((()=>{e._scale=this.settings.hoverScale}),200));const i=s.x-this.center.x,a=s.y-this.center.y,n=Math.sqrt(i*i+a*a),o=this.settings.maxVelocity>0?.2*this.settings.maxVelocity:.1*this.settings.speed;this.velocity.x=-a/n*o||.1*this.settings.speed,this.velocity.y=-i/n*o||.1*this.settings.speed}_onCanvasMouseMove(t){const s=this._getPointer(t),e=this._getTagAt(s);if(e&&e.index!==this._hoveredIndex){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((s=>s(t)))}this._hoveredIndex=e.index,this.settings.hoverEffect&&(e._scale=this.settings.hoverScale,e._color=this.settings.hoverColor||e.color,e._opacity=this.settings.hoverOpacity),this._events.tagHover.forEach((t=>t(e)))}else if(!e&&null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((s=>s(t))),this._hoveredIndex=null}}_onCanvasMouseLeave(){if(null!==this._hoveredIndex){const t=this.tags[this._hoveredIndex];t._scale=1,t._color=t.color,t._opacity=1,this._events.tagLeave.forEach((s=>s(t))),this._hoveredIndex=null}}_getPointer(t){const s=this.canvas.getBoundingClientRect();return{x:t.clientX-s.left,y:t.clientY-s.top}}_getTagAt(t){for(let s=this.tags.length-1;s>=0;s--){const e=this.tags[s],i=e._screen;if(!i)continue;const a=t.x-i.x,n=t.y-i.y;if(Math.abs(a)<=i.width/2&&Math.abs(n)<=i.height/2)return e}return null}_positionTags(){if(!this.tags.length)return;const s=this.settings.radius,e=this.tags.length;switch(this.settings.shape||t){case"torus":const t=this.settings.majorRadius||.6*s,i=this.settings.minorRadius||.3*s,a=Math.ceil(Math.sqrt(e)),n=Math.ceil(e/a);this.tags.forEach(((s,e)=>{const o=e%a*(2*Math.PI/a),h=Math.floor(e/a)*(2*Math.PI/n),c=(t+i*Math.cos(h))*Math.cos(o),r=(t+i*Math.cos(h))*Math.sin(o),l=i*Math.sin(h);s.x=c,s.y=r,s.z=l}));break;case"cube":const o=Math.ceil(Math.cbrt(e)),h=.1;let c=0;this.tags.forEach((t=>{let e,i,a;do{e=c%o-o/2+.5,i=Math.floor(c/o)%o-o/2+.5,a=Math.floor(c/(o*o))-o/2+.5,c++}while(Math.abs(e)<h&&Math.abs(i)<h&&Math.abs(a)<h);t.x=e*(s/o)*2,t.y=i*(s/o)*2,t.z=a*(s/o)*2}));break;case"pyramid":const r=Math.ceil(Math.sqrt(e));let l=0;for(let t=0;t<r;t++){const i=r-t,a=t/r*s*2-s;for(let n=0;n<i&&l<e;n++,l++){const e=n/i*2*Math.PI,o=s*(r-t)/r;this.tags[l].x=o*Math.cos(e),this.tags[l].y=a,this.tags[l].z=o*Math.sin(e)}}break;case"helix":const d=2,v=2*s/e;this.tags.forEach(((t,i)=>{const a=i/e*2*Math.PI*d,n=i*v-s;t.x=s*Math.cos(a),t.y=n,t.z=s*Math.sin(a)}));break;case"ring":this.tags.forEach(((t,i)=>{const a=i/e*2*Math.PI;t.x=s*Math.cos(a),t.y=0,t.z=s*Math.sin(a)}));break;case"verticalRing":this.tags.forEach(((t,i)=>{const a=i/e*2*Math.PI;t.x=0,t.y=s*Math.sin(a),t.z=s*Math.cos(a)}));break;case"cylinder":const g=2*s/Math.ceil(e/10),u=Math.ceil(Math.sqrt(e));this.tags.forEach(((t,e)=>{const i=Math.floor(e/u),a=e%u*(2*Math.PI/u),n=i*g-s;t.x=s*Math.cos(a),t.y=n,t.z=s*Math.sin(a)}));break;default:const y=(1+Math.sqrt(5))/2,_=2*Math.PI*y;this.tags.forEach(((t,i)=>{const a=i/e,n=Math.acos(1-2*a),o=_*i;t.x=s*Math.sin(n)*Math.cos(o),t.y=s*Math.sin(n)*Math.sin(o),t.z=s*Math.cos(n)}))}}_draw(){const{ctx:t,canvas:s,center:e}=this;t.clearRect(0,0,s.width,s.height);const i=[...this.tags].filter((t=>t&&"string"==typeof t.text&&"number"==typeof t.x&&"number"==typeof t.y&&"number"==typeof t.z)).sort(((t,s)=>s.z-t.z));for(const s of i)try{const i=2*e.x+s.z,a=i>0?2*e.x/i:1,n=isFinite(s.x*a+e.x)?s.x*a+e.x:e.x,o=isFinite(s.y*a+e.y)?s.y*a+e.y:e.y,h=isFinite((s.fontSize||15)*a*(s._scale||1))?(s.fontSize||15)*a*(s._scale||1):15,c=s.text,r=2*e.x,l=2*-e.x,d=(s.z-l)/(r-l),v=Math.max(.2,Math.min(1,d));t.globalAlpha=v,t.fillStyle=s._color||s.color||"#fff",t.font=`${this.settings.customFontWeight} ${h}px ${this.settings.customFont}`;const g=t.measureText(c);s._screen={x:n,y:o,width:g.width,height:h},t.fillText(c,n-g.width/2,o+h/2)}catch(t){console.error("Error drawing tag:",s,t)}}_animate(){if(!this.settings.paused){if(this.settings.autoSpin?0===this.settings.maxVelocity&&0===this.velocity.x&&0===this.velocity.y&&(this.velocity.x=.1*this.settings.speed,this.velocity.y=.1*this.settings.speed):0===this.velocity.x&&this.velocity.y,0!==this.velocity.x||0!==this.velocity.y){this.settings.enableEasing?(this.rotation.x+=(this.velocity.x-this.rotation.x)*this.settings.easing,this.rotation.y+=(this.velocity.y-this.rotation.y)*this.settings.easing):(this.rotation.x+=this.velocity.x,this.rotation.y+=this.velocity.y);const s=this.settings.shape||t;"ring"===s||"helix"===s?this.rotation.x=0:"verticalRing"===s&&(this.rotation.y=0);const e=Math.cos(this.rotation.y),i=Math.sin(this.rotation.y),a=Math.cos(this.rotation.x),n=Math.sin(this.rotation.x);this.tags.forEach((t=>{let{x:s,y:o,z:h}=t,c=s*e-h*i,r=s*i+h*e,l=o*a-r*n;r=o*n+r*a,t.x=c,t.y=l,t.z=r}))}this._draw(),this.animFrame=requestAnimationFrame(this._animate.bind(this))}}pause(){this.settings.paused=!0,this.animFrame&&cancelAnimationFrame(this.animFrame),this._events.pause?.forEach((t=>t()))}resume(){this.settings.paused=!1,this._animate(),this._events.resume?.forEach((t=>t()))}destroy(){this.pause(),window.removeEventListener("resize",this._resize),this.canvas.removeEventListener("touchstart",this._touchStartHandler),this.canvas.removeEventListener("touchmove",this._touchMoveHandler),this.canvas.removeEventListener("touchend",this._bindTouch),this.canvas.removeEventListener("mousedown",this._bindMouse),this.canvas.removeEventListener("mousemove",this._onCanvasMouseMove),this.canvas.removeEventListener("mouseup",this._bindMouse),this.canvas.removeEventListener("mouseleave",this._onCanvasMouseLeave),this.canvas.removeEventListener("click",this._onCanvasClick),window.removeEventListener("deviceorientation",this._orientationHandler),this.canvas.parentNode&&this.canvas.replaceWith(this.canvas.cloneNode(!0)),this.tags=[]}}}));
//# sourceMappingURL=orbity.min.js.map
