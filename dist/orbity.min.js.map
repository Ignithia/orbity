{"version":3,"file":"orbity.min.js","sources":["../src/orbity.js"],"sourcesContent":["/* Orbity.js is inspired by tagcanvas.js \r\nlink to tagcanvas.js: https://www.goat1000.com/tagcanvas.php\r\nThanks to the original author for the inspiration! */\r\n\r\nconst DEFAULT_SHAPE = \"sphere\";\r\n\r\nconst EASING_PROFILES = {\r\n  Snappy: { easeIn: 0.2, friction: 0.9 },\r\n  Smooth: { easeIn: 0.1, friction: 0.95 },\r\n  Marathon: { easeIn: 0.05, friction: 0.99 },\r\n};\r\n\r\nclass Orbity {\r\n  /**\r\n   * Creates an instance of Orbity.\r\n   * @param {HTMLCanvasElement} canvas - The canvas element where the 3D tag cloud will be rendered.\r\n   * @param {Object} options - Configuration options for the tag cloud.\r\n   * @param {number} [options.radius=150] - Radius of the 3D sphere or other shapes.\r\n   * @param {number} [options.speed=0.002] - Speed of rotation.\r\n   * @param {number} [options.easing=0.05] - Easing factor for smooth rotation.\r\n   * @param {boolean} [options.paused=false] - Whether the animation starts paused.\r\n   * @param {boolean} [options.enableTouch=true] - Enable touch interaction.\r\n   * @param {boolean} [options.enableOrientation=false] - Enable device orientation interaction.\r\n   * @param {number} [options.maxVelocity=0.05] - Maximum velocity for rotation.\r\n   * @param {string} [options.shape=DEFAULT_SHAPE] - Shape of the tag cloud (e.g., \"sphere\", \"cube\", \"plane\", \"helix\", \"ring\", \"verticalRing\", \"cylinder\", \"pyramid\", \"torus\").\r\n   * @param {boolean} [options.enableDrag=true] - Enable drag interaction.\r\n   * @param {boolean} [options.enableClick=true] - Enable click interaction.\r\n   * @param {boolean} [options.hoverEffect=true] - Enable/disable hover effects.\r\n   * @param {boolean} [options.clickEffect=true] - Enable/disable click effects.\r\n   * @param {number} [options.hoverScale=1.2] - Scale factor for hover effect.\r\n   * @param {string} [options.hoverColor=\"#ff0\"] - Color change on hover.\r\n   * @param {number} [options.hoverOpacity=1.0] - Opacity change on hover.\r\n   * @param {string} [options.customFont=\"sans-serif\"] - Default font family.\r\n   * @param {string} [options.customFontWeight=\"normal\"] - Default font weight.\r\n   * @param {number} [options.majorRadius] - Major radius for the torus shape.\r\n   * @param {number} [options.minorRadius] - Minor radius for the torus shape.\r\n   */\r\n  constructor(canvas, options = {}) {\r\n    this.canvas = canvas;\r\n    this.ctx = canvas.getContext(\"2d\");\r\n    this.tags = [];\r\n    this.settings = Object.assign(\r\n      {\r\n        radius: 150,\r\n        speed: 1,\r\n        easing: 0.1,\r\n        enableEasing: true,\r\n        paused: false,\r\n        enableTouch: true,\r\n        enableOrientation: false,\r\n        maxVelocity: 0.5,\r\n        shape: DEFAULT_SHAPE,\r\n        enableDrag: true,\r\n        enableClick: true,\r\n        autoSpin: true,\r\n        hoverEffect: true,\r\n        clickEffect: true,\r\n        hoverScale: 1.2,\r\n        hoverColor: \"#ff0\",\r\n        hoverOpacity: 1.0,\r\n        customFont: \"sans-serif\",\r\n        customFontWeight: \"normal\",\r\n        easingProfile: \"Smooth\",\r\n        customEaseIn: 0.1,\r\n        customFriction: 0.95,\r\n        autoEasing: true,\r\n        minVelocityThreshold: 0.005,\r\n      },\r\n      options\r\n    );\r\n    this.rotation = { x: 0, y: 0 };\r\n    this.velocity = { x: 0, y: 0 };\r\n\r\n    if (this.settings.autoSpin) {\r\n      this.velocity.x = this.settings.speed * 0.1;\r\n      this.velocity.y = this.settings.speed * 0.1;\r\n    }\r\n\r\n    this.touch = { x: 0, y: 0, active: false };\r\n    this.animFrame = null;\r\n    this._events = { tagClick: [], tagHover: [], tagLeave: [] };\r\n    this._hoveredIndex = null;\r\n    this.undoStack = [];\r\n    this.redoStack = [];\r\n\r\n    this.settings.easing = Math.min(Math.max(this.settings.easing, 0.01), 0.5);\r\n    this.settings.speed = Math.min(Math.max(this.settings.speed, 0.1), 5);\r\n    this._orientationHandler = this._handleOrientation.bind(this);\r\n    this._touchStartHandler = this._onTouchStart.bind(this);\r\n    this._touchMoveHandler = this._onTouchMove.bind(this);\r\n    this._mouseMoveHandler = this._onCanvasMouseMove.bind(this);\r\n    this._mouseLeaveHandler = this._onCanvasMouseLeave.bind(this);\r\n    this._clickHandler = this._onCanvasClick.bind(this);\r\n    this._init();\r\n  }\r\n\r\n  /**\r\n   * Throttles a function to limit its execution rate.\r\n   * @private\r\n   * @param {Function} func - The function to throttle.\r\n   * @param {number} limit - The time limit in milliseconds.\r\n   * @returns {Function} The throttled function.\r\n   */\r\n  _throttle(func, limit) {\r\n    let lastFunc;\r\n    let lastRan;\r\n    return function (...args) {\r\n      const context = this;\r\n      if (!lastRan) {\r\n        func.apply(context, args);\r\n        lastRan = Date.now();\r\n      } else {\r\n        clearTimeout(lastFunc);\r\n        lastFunc = setTimeout(function () {\r\n          if (Date.now() - lastRan >= limit) {\r\n            func.apply(context, args);\r\n            lastRan = Date.now();\r\n          }\r\n        }, limit - (Date.now() - lastRan));\r\n      }\r\n    };\r\n  }\r\n\r\n  /**\r\n   * Initializes the Orbity instance by setting up the canvas, event listeners, and starting the animation.\r\n   * @private\r\n   */\r\n  _init() {\r\n    this._resize = this._throttle(this._resize.bind(this), 200);\r\n    this._onCanvasMouseMove = this._throttle(\r\n      this._onCanvasMouseMove.bind(this),\r\n      50\r\n    );\r\n    window.addEventListener(\"resize\", this._resize);\r\n    this._bindTouch();\r\n    this._bindMouse();\r\n    this._bindOrientation();\r\n    this._attachInteraction();\r\n    this.canvas.setAttribute(\"role\", \"img\");\r\n    this.canvas.setAttribute(\"aria-label\", \"3D tag cloud visualization\");\r\n    this._resize();\r\n    this._positionTags();\r\n    this._animate();\r\n  }\r\n\r\n  /**\r\n   * Resizes the canvas to match its container and recalculates the center and tag positions.\r\n   * @private\r\n   */\r\n  _resize() {\r\n    this.canvas.width = this.canvas.offsetWidth;\r\n    this.canvas.height = this.canvas.offsetHeight;\r\n    this.center = { x: this.canvas.width / 2, y: this.canvas.height / 2 };\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Sets the tags to be displayed in the 3D tag cloud.\r\n   * @param {Array<Object>} dataArray - Array of tag data objects.\r\n   * Each object should have the following properties:\r\n   *   - text {string}: The text of the tag.\r\n   *   - color {string}: The color of the tag (e.g., \"#fff\").\r\n   *   - fontSize {number} (optional): The font size of the tag.\r\n   */\r\n  setTags(dataArray) {\r\n    this.tags = dataArray.map((data, i) => ({\r\n      ...data,\r\n      angleX: Math.random() * 2 * Math.PI,\r\n      angleY: Math.random() * Math.PI,\r\n      index: i,\r\n      _screen: {},\r\n      _scale: 1,\r\n      _color: data.color,\r\n      _opacity: 1,\r\n    }));\r\n    this._reindexTags();\r\n    this._positionTags();\r\n    this._draw();\r\n  }\r\n\r\n  /**\r\n   * Generates a random angle for tag positioning.\r\n   * @private\r\n   * @returns {number} A random angle in radians.\r\n   */\r\n  _getRandomAngle() {\r\n    return Math.random() * 2 * Math.PI;\r\n  }\r\n\r\n  /**\r\n   * Adds a single tag to the 3D tag cloud and records the action for undo/redo.\r\n   * @param {Object} tagData - Data for the new tag.\r\n   */\r\n  addTag(tagData) {\r\n    if (!this._validateTag(tagData)) return;\r\n    const newTag = {\r\n      ...tagData,\r\n      angleX: this._getRandomAngle(),\r\n      angleY: this._getRandomAngle(),\r\n      index: this.tags.length,\r\n      _screen: {},\r\n      _scale: 1,\r\n      _color: tagData.color,\r\n      _opacity: 1,\r\n    };\r\n    this.tags.push(newTag);\r\n    this.undoStack.push({ action: \"add\", tag: { ...newTag } });\r\n    this.redoStack = [];\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Removes a tag from the 3D tag cloud by its index and records the action for undo/redo.\r\n   * @param {number} index - Index of the tag to remove.\r\n   */\r\n  removeTag(index) {\r\n    if (index < 0 || index >= this.tags.length) return;\r\n    const removedTag = this.tags.splice(index, 1)[0];\r\n    this.undoStack.push({ action: \"remove\", tag: { ...removedTag }, index });\r\n    this.redoStack = [];\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Updates the data of an existing tag and records the action for undo/redo.\r\n   * @param {number} index - Index of the tag to update.\r\n   * @param {Object} data - New data for the tag.\r\n   */\r\n  updateTag(index, data) {\r\n    if (!this.tags[index]) {\r\n      console.error(`Tag at index ${index} does not exist.`);\r\n      return;\r\n    }\r\n    const oldData = { ...this.tags[index] };\r\n    Object.assign(this.tags[index], data, {\r\n      _scale: 1,\r\n      _color: data.color || this.tags[index].color,\r\n      _opacity: 1,\r\n    });\r\n    this.undoStack.push({\r\n      action: \"update\",\r\n      oldData,\r\n      newData: { ...this.tags[index] },\r\n    });\r\n    this.redoStack = [];\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Undoes the last tag-related action.\r\n   */\r\n  undo() {\r\n    if (this.undoStack.length === 0) return;\r\n    const lastAction = this.undoStack.pop();\r\n    this.redoStack.push(lastAction);\r\n\r\n    switch (lastAction.action) {\r\n      case \"add\":\r\n        this.tags.pop();\r\n        break;\r\n      case \"remove\":\r\n        this.tags.splice(lastAction.index, 0, { ...lastAction.tag });\r\n        break;\r\n      case \"update\":\r\n        Object.assign(this.tags[lastAction.oldData.index], lastAction.oldData);\r\n        break;\r\n    }\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Redoes the last undone action.\r\n   */\r\n  redo() {\r\n    if (this.redoStack.length === 0) return;\r\n    const lastAction = this.redoStack.pop();\r\n    this.undoStack.push(lastAction);\r\n\r\n    switch (lastAction.action) {\r\n      case \"add\":\r\n        this.tags.push({ ...lastAction.tag });\r\n        break;\r\n      case \"remove\":\r\n        this.tags.splice(lastAction.index, 1);\r\n        break;\r\n      case \"update\":\r\n        Object.assign(this.tags[lastAction.newData.index], lastAction.newData);\r\n        break;\r\n    }\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Clears all tags from the 3D tag cloud.\r\n   */\r\n  clearTags() {\r\n    this.tags = [];\r\n    this._reindexTags();\r\n    this._positionTags();\r\n  }\r\n\r\n  /**\r\n   * Updates the configuration options for the Orbity instance.\r\n   * @param {Object} newOptions - New configuration options.\r\n   */\r\n  updateOptions(newOptions) {\r\n    this.settings = { ...this.settings, ...newOptions };\r\n\r\n    if (newOptions.easing !== undefined) {\r\n      if (typeof newOptions.easing !== \"number\") {\r\n        console.error(\"Invalid easing: must be a number\");\r\n        this.settings.easing = 0.1;\r\n      } else {\r\n        this.settings.easing = newOptions.easing;\r\n      }\r\n    }\r\n\r\n    if (newOptions.speed !== undefined) {\r\n      if (typeof newOptions.speed !== \"number\") {\r\n        console.error(\"Invalid speed: must be a \");\r\n        this.settings.speed = 1;\r\n      } else {\r\n        this.settings.speed = newOptions.speed;\r\n      }\r\n    }\r\n\r\n    if (newOptions.radius !== undefined) {\r\n      if (typeof newOptions.radius !== \"number\" || newOptions.radius <= 0) {\r\n        console.error(\"Invalid radius: must be a positive number.\");\r\n        this.settings.radius = 150;\r\n      }\r\n    }\r\n\r\n    if (newOptions.shape !== undefined) {\r\n      const validShapes = [\r\n        \"sphere\",\r\n        \"cube\",\r\n        \"plane\",\r\n        \"helix\",\r\n        \"ring\",\r\n        \"verticalRing\",\r\n        \"cylinder\",\r\n        \"pyramid\",\r\n        \"torus\",\r\n      ];\r\n      if (!validShapes.includes(newOptions.shape)) {\r\n        console.error(\r\n          `Invalid shape: must be one of ${validShapes.join(\", \")}.`\r\n        );\r\n        this.settings.shape = DEFAULT_SHAPE;\r\n      }\r\n    }\r\n\r\n    if (newOptions.maxVelocity !== undefined) {\r\n      if (\r\n        typeof newOptions.maxVelocity !== \"number\" ||\r\n        newOptions.maxVelocity < 0\r\n      ) {\r\n        console.error(\"Invalid maxVelocity: must be a non-negative number.\");\r\n        this.settings.maxVelocity = 0.5;\r\n      }\r\n    }\r\n\r\n    if (newOptions.radius !== undefined || newOptions.shape !== undefined) {\r\n      this._positionTags();\r\n    }\r\n\r\n    if (newOptions.enableTouch !== undefined) {\r\n      if (newOptions.enableTouch) {\r\n        this._bindTouch();\r\n      } else {\r\n        this.canvas.removeEventListener(\"touchstart\", this._touchStartHandler);\r\n        this.canvas.removeEventListener(\"touchmove\", this._touchMoveHandler);\r\n        this.canvas.removeEventListener(\"touchend\", this._bindTouch);\r\n      }\r\n    }\r\n\r\n    if (newOptions.enableOrientation !== undefined) {\r\n      if (newOptions.enableOrientation) {\r\n        this._bindOrientation();\r\n      } else {\r\n        window.removeEventListener(\r\n          \"deviceorientation\",\r\n          this._orientationHandler\r\n        );\r\n      }\r\n    }\r\n\r\n    if (newOptions.enableClick !== undefined) {\r\n      if (newOptions.enableClick) {\r\n        this.canvas.addEventListener(\"click\", this._clickHandler);\r\n      } else {\r\n        this.canvas.removeEventListener(\"click\", this._clickHandler);\r\n      }\r\n    }\r\n\r\n    if (newOptions.paused !== undefined) {\r\n      if (newOptions.paused) {\r\n        this.pause();\r\n      } else {\r\n        this.resume();\r\n      }\r\n    }\r\n\r\n    if (newOptions.easingProfile !== undefined) {\r\n      this.setEasingProfile(newOptions.easingProfile);\r\n    }\r\n    if (newOptions.autoEasing !== undefined) {\r\n      this.toggleAutoEasing(newOptions.autoEasing);\r\n    }\r\n    if (newOptions.customEaseIn !== undefined) {\r\n      this.settings.customEaseIn = newOptions.customEaseIn;\r\n    }\r\n    if (newOptions.customFriction !== undefined) {\r\n      this.settings.customFriction = newOptions.customFriction;\r\n    }\r\n    if (newOptions.minVelocityThreshold !== undefined) {\r\n      this.settings.minVelocityThreshold = newOptions.minVelocityThreshold;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Validates the tag data.\r\n   * @private\r\n   * @param {Object} tagData - Data for the tag.\r\n   * @returns {boolean} True if the tag data is valid, false otherwise.\r\n   */\r\n  _validateTag(tagData) {\r\n    if (!tagData.text || typeof tagData.text !== \"string\") {\r\n      console.error(\"Invalid tag: 'text' is required and must be a string.\");\r\n      return false;\r\n    }\r\n    if (!tagData.color || !/^#[0-9A-F]{6}$/i.test(tagData.color)) {\r\n      console.error(\"Invalid tag: 'color' must be a valid hex color code.\");\r\n      return false;\r\n    }\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * Handles drag-like interactions for rotating the tag cloud.\r\n   * @private\r\n   */\r\n  _bindDragEvents(startEvent, moveEvent, endEvent, getPosition) {\r\n    if (!this._dragHandlers) this._dragHandlers = {};\r\n\r\n    if (this._dragHandlers[startEvent]) {\r\n      this.canvas.removeEventListener(\r\n        startEvent,\r\n        this._dragHandlers[startEvent]\r\n      );\r\n      this.canvas.removeEventListener(moveEvent, this._dragHandlers[moveEvent]);\r\n      this.canvas.removeEventListener(endEvent, this._dragHandlers[endEvent]);\r\n      this.canvas.removeEventListener(\r\n        \"mouseleave\",\r\n        this._dragHandlers.mouseleave\r\n      );\r\n    }\r\n\r\n    let isDragging = false;\r\n    let lastX = 0;\r\n    let lastY = 0;\r\n\r\n    const startHandler = (e) => {\r\n      if (!this.settings.enableDrag) return;\r\n      isDragging = true;\r\n      const pos = getPosition(e);\r\n      lastX = pos.x;\r\n      lastY = pos.y;\r\n\r\n      if (this.velocity.x === 0 && this.velocity.y === 0) {\r\n        this.velocity.x = this.settings.speed * 0.1;\r\n        this.velocity.y = this.settings.speed * 0.1;\r\n      }\r\n    };\r\n\r\n    const moveHandler = (e) => {\r\n      if (!this.settings.enableDrag || !isDragging) return;\r\n\r\n      const pos = getPosition(e);\r\n      const dx = pos.x - lastX;\r\n      const dy = pos.y - lastY;\r\n\r\n      if (this.settings.maxVelocity > 0) {\r\n        this.velocity.x = Math.min(\r\n          Math.max(dy * this.settings.speed, -this.settings.maxVelocity),\r\n          this.settings.maxVelocity\r\n        );\r\n        this.velocity.y = Math.min(\r\n          Math.max(dx * this.settings.speed, -this.settings.maxVelocity),\r\n          this.settings.maxVelocity\r\n        );\r\n      } else {\r\n        this.velocity.x = dy * this.settings.speed * 0.1;\r\n        this.velocity.y = dx * this.settings.speed * 0.1;\r\n      }\r\n\r\n      lastX = pos.x;\r\n      lastY = pos.y;\r\n\r\n      if (e.preventDefault) e.preventDefault();\r\n    };\r\n\r\n    const endHandler = () => {\r\n      if (!this.settings.enableDrag) return;\r\n      isDragging = false;\r\n      this._applyDragEasing();\r\n    };\r\n\r\n    const leaveHandler = () => {\r\n      if (!this.settings.enableDrag) return;\r\n      if (isDragging) {\r\n        isDragging = false;\r\n        this._applyDragEasing();\r\n      }\r\n    };\r\n\r\n    this.canvas.addEventListener(startEvent, startHandler);\r\n    this.canvas.addEventListener(moveEvent, moveHandler, { passive: false });\r\n    this.canvas.addEventListener(endEvent, endHandler);\r\n    this.canvas.addEventListener(\"mouseleave\", leaveHandler);\r\n\r\n    this._dragHandlers[startEvent] = startHandler;\r\n    this._dragHandlers[moveEvent] = moveHandler;\r\n    this._dragHandlers[endEvent] = endHandler;\r\n    this._dragHandlers.mouseleave = leaveHandler;\r\n  }\r\n\r\n  /**\r\n   * Handles touch interactions for rotating the tag cloud.\r\n   * @private\r\n   */\r\n  _bindTouch() {\r\n    if (!this.settings.enableTouch) return;\r\n\r\n    this._bindDragEvents(\"touchstart\", \"touchmove\", \"touchend\", (e) => ({\r\n      x: e.touches[0].clientX,\r\n      y: e.touches[0].clientY,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Handles the touch start event to initiate touch interaction.\r\n   * @private\r\n   * @param {TouchEvent} event - The touch start event.\r\n   */\r\n  _onTouchStart(event) {\r\n    if (event.touches.length === 1) {\r\n      const touch = event.touches[0];\r\n      this.touch.x = touch.clientX;\r\n      this.touch.y = touch.clientY;\r\n      this.touch.active = true;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles the touch move event to update touch interaction.\r\n   * @private\r\n   * @param {TouchEvent} event - The touch move event.\r\n   */\r\n  _onTouchMove(event) {\r\n    if (event.touches.length === 1 && this.touch.active) {\r\n      const touch = event.touches[0];\r\n      const dx = touch.clientX - this.touch.x;\r\n      const dy = touch.clientY - this.touch.y;\r\n\r\n      if (this.settings.maxVelocity > 0) {\r\n        this.velocity.x = Math.min(\r\n          Math.max(dy * this.settings.speed, -this.settings.maxVelocity),\r\n          this.settings.maxVelocity\r\n        );\r\n        this.velocity.y = Math.min(\r\n          Math.max(dx * this.settings.speed, -this.settings.maxVelocity),\r\n          this.settings.maxVelocity\r\n        );\r\n      } else {\r\n        this.velocity.x = dy * this.settings.speed * 0.1;\r\n        this.velocity.y = dx * this.settings.speed * 0.1;\r\n      }\r\n\r\n      this.touch.x = touch.clientX;\r\n      this.touch.y = touch.clientY;\r\n\r\n      if (event.preventDefault) event.preventDefault();\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Handles mouse interactions for rotating the tag cloud.\r\n   * @private\r\n   */\r\n  _bindMouse() {\r\n    this._bindDragEvents(\"mousedown\", \"mousemove\", \"mouseup\", (e) => ({\r\n      x: e.clientX,\r\n      y: e.clientY,\r\n    }));\r\n  }\r\n\r\n  /**\r\n   * Sets the easing profile for the rotation animation.\r\n   * @param {string} profileName - The name of the easing profile (e.g., \"Smooth\").\r\n   */\r\n  setEasingProfile(profileName) {\r\n    if (profileName === \"Custom\") {\r\n      this.settings.easingProfile = profileName;\r\n      return;\r\n    }\r\n    if (EASING_PROFILES[profileName]) {\r\n      this.settings.easingProfile = profileName;\r\n      const { easeIn, friction } = EASING_PROFILES[profileName];\r\n      this.settings.customEaseIn = easeIn;\r\n      this.settings.customFriction = friction;\r\n    } else {\r\n      console.error(`Invalid easing profile: ${profileName}`);\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Toggles auto-easing for the rotation animation.\r\n   * @param {boolean} enabled - Whether to enable or disable auto-easing.\r\n   */\r\n  toggleAutoEasing(enabled) {\r\n    this.settings.autoEasing = enabled;\r\n  }\r\n\r\n  _applyDragEasing() {\r\n    const { customFriction, minVelocityThreshold } = this.settings;\r\n\r\n    const easeOut = () => {\r\n      this.velocity.x *= customFriction;\r\n      this.velocity.y *= customFriction;\r\n\r\n      if (Math.abs(this.velocity.x) < minVelocityThreshold) this.velocity.x = 0;\r\n      if (Math.abs(this.velocity.y) < minVelocityThreshold) this.velocity.y = 0;\r\n\r\n      if (this.velocity.x !== 0 || this.velocity.y !== 0) {\r\n        requestAnimationFrame(easeOut);\r\n      }\r\n    };\r\n\r\n    easeOut();\r\n  }\r\n\r\n  /**\r\n   * Handles device orientation interactions for rotating the tag cloud.\r\n   * @private\r\n   */\r\n  _bindOrientation() {\r\n    if (!this.settings.enableOrientation) return;\r\n\r\n    let lastUpdate = 0;\r\n    const throttleDelay = 100;\r\n\r\n    const handleOrientation = (e) => {\r\n      const now = Date.now();\r\n      if (now - lastUpdate < throttleDelay) return;\r\n      lastUpdate = now;\r\n\r\n      const { gamma = 0, beta = 0 } = e;\r\n      this.velocity.x = gamma * 0.0005;\r\n      this.velocity.y = beta * 0.0005;\r\n    };\r\n\r\n    window.addEventListener(\"deviceorientation\", handleOrientation);\r\n  }\r\n\r\n  /**\r\n   * Handles device orientation events to update the rotation velocity.\r\n   * @private\r\n   * @param {DeviceOrientationEvent} event - The device orientation event.\r\n   */\r\n  _handleOrientation(event) {\r\n    const { beta, gamma } = event;\r\n    if (beta !== null && gamma !== null) {\r\n      this.velocity.x = gamma * 0.0005;\r\n      this.velocity.y = beta * 0.0005;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Attaches mouse interaction events for the tag cloud.\r\n   * @private\r\n   */\r\n  _attachInteraction() {\r\n    if (this.settings.enableClick) {\r\n      this.canvas.addEventListener(\"click\", this._onCanvasClick.bind(this));\r\n    }\r\n    this.canvas.addEventListener(\r\n      \"mousemove\",\r\n      this._onCanvasMouseMove.bind(this)\r\n    );\r\n    this.canvas.addEventListener(\r\n      \"mouseleave\",\r\n      this._onCanvasMouseLeave.bind(this)\r\n    );\r\n  }\r\n\r\n  _onCanvasClick(e) {\r\n    const pt = this._getPointer(e);\r\n    const tag = this._getTagAt(pt);\r\n\r\n    if (tag && this.settings.clickEffect) {\r\n      tag._scale = this.settings.hoverScale * 1.1;\r\n      setTimeout(() => {\r\n        tag._scale = this.settings.hoverScale;\r\n      }, 200);\r\n    }\r\n\r\n    const dx = pt.x - this.center.x;\r\n    const dy = pt.y - this.center.y;\r\n\r\n    const distance = Math.sqrt(dx * dx + dy * dy);\r\n    const velocityMagnitude =\r\n      this.settings.maxVelocity > 0\r\n        ? this.settings.maxVelocity * 0.2\r\n        : this.settings.speed * 0.1;\r\n\r\n    this.velocity.x =\r\n      -(dy / distance) * velocityMagnitude || this.settings.speed * 0.1;\r\n    this.velocity.y =\r\n      -(dx / distance) * velocityMagnitude || this.settings.speed * 0.1;\r\n  }\r\n\r\n  _onCanvasMouseMove(e) {\r\n    const pt = this._getPointer(e);\r\n    const tag = this._getTagAt(pt);\r\n\r\n    if (tag && tag.index !== this._hoveredIndex) {\r\n      if (this._hoveredIndex !== null) {\r\n        const prev = this.tags[this._hoveredIndex];\r\n        prev._scale = 1;\r\n        prev._color = prev.color;\r\n        prev._opacity = 1;\r\n        this._events.tagLeave.forEach((cb) => cb(prev));\r\n      }\r\n      this._hoveredIndex = tag.index;\r\n      if (this.settings.hoverEffect) {\r\n        tag._scale = this.settings.hoverScale;\r\n        tag._color = this.settings.hoverColor || tag.color;\r\n        tag._opacity = this.settings.hoverOpacity;\r\n      }\r\n      this._events.tagHover.forEach((cb) => cb(tag));\r\n    } else if (!tag && this._hoveredIndex !== null) {\r\n      const prev = this.tags[this._hoveredIndex];\r\n      prev._scale = 1;\r\n      prev._color = prev.color;\r\n      prev._opacity = 1;\r\n      this._events.tagLeave.forEach((cb) => cb(prev));\r\n      this._hoveredIndex = null;\r\n    }\r\n  }\r\n\r\n  _onCanvasMouseLeave() {\r\n    if (this._hoveredIndex !== null) {\r\n      const prev = this.tags[this._hoveredIndex];\r\n      prev._scale = 1;\r\n      prev._color = prev.color;\r\n      prev._opacity = 1;\r\n      this._events.tagLeave.forEach((cb) => cb(prev));\r\n      this._hoveredIndex = null;\r\n    }\r\n  }\r\n\r\n  _getPointer(e) {\r\n    const rect = this.canvas.getBoundingClientRect();\r\n    return { x: e.clientX - rect.left, y: e.clientY - rect.top };\r\n  }\r\n\r\n  _getTagAt(pt) {\r\n    for (let i = this.tags.length - 1; i >= 0; i--) {\r\n      const tag = this.tags[i];\r\n      const s = tag._screen;\r\n      if (!s) continue;\r\n      const dx = pt.x - s.x;\r\n      const dy = pt.y - s.y;\r\n      if (Math.abs(dx) <= s.width / 2 && Math.abs(dy) <= s.height / 2)\r\n        return tag;\r\n    }\r\n    return null;\r\n  }\r\n\r\n  _positionTags() {\r\n    if (!this.tags.length) return;\r\n\r\n    const R = this.settings.radius;\r\n    const N = this.tags.length;\r\n    const shape = this.settings.shape || DEFAULT_SHAPE;\r\n\r\n    switch (shape) {\r\n      case \"torus\":\r\n        const majorRadius = this.settings.majorRadius || R * 0.6;\r\n        const minorRadius = this.settings.minorRadius || R * 0.3;\r\n        const majorSteps = Math.ceil(Math.sqrt(N));\r\n        const minorSteps = Math.ceil(N / majorSteps);\r\n\r\n        this.tags.forEach((tag, i) => {\r\n          const majorAngle = (i % majorSteps) * ((2 * Math.PI) / majorSteps);\r\n          const minorAngle =\r\n            Math.floor(i / majorSteps) * ((2 * Math.PI) / minorSteps);\r\n\r\n          const x =\r\n            (majorRadius + minorRadius * Math.cos(minorAngle)) *\r\n            Math.cos(majorAngle);\r\n          const y =\r\n            (majorRadius + minorRadius * Math.cos(minorAngle)) *\r\n            Math.sin(majorAngle);\r\n          const z = minorRadius * Math.sin(minorAngle);\r\n\r\n          tag.x = x;\r\n          tag.y = y;\r\n          tag.z = z;\r\n        });\r\n        break;\r\n\r\n      case \"cube\":\r\n        const side = Math.ceil(Math.cbrt(N));\r\n        const threshold = 0.1;\r\n        let validTags = 0;\r\n\r\n        this.tags.forEach((tag) => {\r\n          let x, y, z;\r\n\r\n          do {\r\n            x = (validTags % side) - side / 2 + 0.5;\r\n            y = (Math.floor(validTags / side) % side) - side / 2 + 0.5;\r\n            z = Math.floor(validTags / (side * side)) - side / 2 + 0.5;\r\n            validTags++;\r\n          } while (\r\n            Math.abs(x) < threshold &&\r\n            Math.abs(y) < threshold &&\r\n            Math.abs(z) < threshold\r\n          );\r\n\r\n          tag.x = x * (R / side) * 2;\r\n          tag.y = y * (R / side) * 2;\r\n          tag.z = z * (R / side) * 2;\r\n        });\r\n        break;\r\n\r\n      case \"pyramid\":\r\n        const levels = Math.ceil(Math.sqrt(N));\r\n        let index = 0;\r\n        for (let level = 0; level < levels; level++) {\r\n          const levelSize = levels - level;\r\n          const y = (level / levels) * R * 2 - R;\r\n          for (let i = 0; i < levelSize && index < N; i++, index++) {\r\n            const angle = (i / levelSize) * 2 * Math.PI;\r\n            const radius = (R * (levels - level)) / levels;\r\n            this.tags[index].x = radius * Math.cos(angle);\r\n            this.tags[index].y = y;\r\n            this.tags[index].z = radius * Math.sin(angle);\r\n          }\r\n        }\r\n        break;\r\n      case \"helix\":\r\n        const turns = 2;\r\n        const spacing = (2 * R) / N;\r\n        this.tags.forEach((tag, i) => {\r\n          const angle = (i / N) * 2 * Math.PI * turns;\r\n          const height = -R + i * spacing;\r\n          tag.x = R * Math.cos(angle);\r\n          tag.y = height;\r\n          tag.z = R * Math.sin(angle);\r\n        });\r\n        break;\r\n      case \"ring\":\r\n        this.tags.forEach((tag, i) => {\r\n          const angle = (i / N) * 2 * Math.PI;\r\n          tag.x = R * Math.cos(angle);\r\n          tag.y = 0;\r\n          tag.z = R * Math.sin(angle);\r\n        });\r\n        break;\r\n      case \"verticalRing\":\r\n        this.tags.forEach((tag, i) => {\r\n          const angle = (i / N) * 2 * Math.PI;\r\n          tag.x = 0;\r\n          tag.y = R * Math.sin(angle);\r\n          tag.z = R * Math.cos(angle);\r\n        });\r\n        break;\r\n      case \"cylinder\":\r\n        const heightStep = (2 * R) / Math.ceil(N / 10);\r\n        const circumferenceTags = Math.ceil(Math.sqrt(N));\r\n        this.tags.forEach((tag, i) => {\r\n          const level = Math.floor(i / circumferenceTags);\r\n          const angle =\r\n            (i % circumferenceTags) * ((2 * Math.PI) / circumferenceTags);\r\n          const height = -R + level * heightStep;\r\n          tag.x = R * Math.cos(angle);\r\n          tag.y = height;\r\n          tag.z = R * Math.sin(angle);\r\n        });\r\n        break;\r\n\r\n      case \"plane\":\r\n        const gridCols = Math.ceil(Math.sqrt(N));\r\n        const gridRows = Math.ceil(N / gridCols);\r\n        const spacingX = (2 * R) / (gridCols - 1 || 1);\r\n        const spacingZ = (2 * R) / (gridRows - 1 || 1);\r\n        this.tags.forEach((tag, i) => {\r\n          const col = i % gridCols;\r\n          const row = Math.floor(i / gridCols);\r\n          tag.x = -R + col * spacingX;\r\n          tag.y = 0;\r\n          tag.z = -R + row * spacingZ;\r\n        });\r\n        break;\r\n\r\n      case \"sphere\":\r\n      default:\r\n        const goldenRatio = (1 + Math.sqrt(5)) / 2;\r\n        const angleIncrement = Math.PI * 2 * goldenRatio;\r\n        this.tags.forEach((tag, i) => {\r\n          const t = i / N;\r\n          const inclination = Math.acos(1 - 2 * t);\r\n          const azimuth = angleIncrement * i;\r\n          tag.x = R * Math.sin(inclination) * Math.cos(azimuth);\r\n          tag.y = R * Math.sin(inclination) * Math.sin(azimuth);\r\n          tag.z = R * Math.cos(inclination);\r\n        });\r\n        break;\r\n    }\r\n  }\r\n\r\n  _draw() {\r\n    const { ctx, canvas, center } = this;\r\n    ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n\r\n    const sortedTags = [...this.tags]\r\n      .filter(\r\n        (tag) =>\r\n          tag &&\r\n          typeof tag.text === \"string\" &&\r\n          typeof tag.x === \"number\" &&\r\n          typeof tag.y === \"number\" &&\r\n          typeof tag.z === \"number\"\r\n      )\r\n      .sort((a, b) => b.z - a.z);\r\n\r\n    for (const tag of sortedTags) {\r\n      try {\r\n        const denominator = center.x * 2 + tag.z;\r\n        const scale = denominator > 0 ? (center.x * 2) / denominator : 1;\r\n\r\n        const x = isFinite(tag.x * scale + center.x)\r\n          ? tag.x * scale + center.x\r\n          : center.x;\r\n        const y = isFinite(tag.y * scale + center.y)\r\n          ? tag.y * scale + center.y\r\n          : center.y;\r\n        const fontSize = isFinite(\r\n          (tag.fontSize || 15) * scale * (tag._scale || 1)\r\n        )\r\n          ? (tag.fontSize || 15) * scale * (tag._scale || 1)\r\n          : 15;\r\n\r\n        const text = tag.text;\r\n\r\n        const maxZ = center.x * 2;\r\n        const minZ = -center.x * 2;\r\n        const normalizedZ = (tag.z - minZ) / (maxZ - minZ);\r\n        const opacity = Math.max(0.2, Math.min(1, normalizedZ));\r\n\r\n        ctx.globalAlpha = opacity;\r\n        ctx.fillStyle = tag._color || tag.color || \"#fff\";\r\n        ctx.font = `${this.settings.customFontWeight} ${fontSize}px ${this.settings.customFont}`;\r\n        const metrics = ctx.measureText(text);\r\n\r\n        tag._screen = {\r\n          x,\r\n          y,\r\n          width: metrics.width,\r\n          height: fontSize,\r\n        };\r\n        ctx.fillText(text, x - metrics.width / 2, y + fontSize / 2);\r\n      } catch (error) {\r\n        console.error(\"Error drawing tag:\", tag, error);\r\n      }\r\n    }\r\n  }\r\n\r\n  /**\r\n   * Animates the rotation of the tag cloud.\r\n   * @private\r\n   */\r\n  _animate() {\r\n    if (this.settings.paused) return;\r\n\r\n    if (this.settings.autoSpin && !this.settings.paused) {\r\n      const { customEaseIn, autoEasing } = this.settings;\r\n      if (autoEasing) {\r\n        this.velocity.x +=\r\n          (this.settings.speed * 0.1 - this.velocity.x) * customEaseIn;\r\n        this.velocity.y +=\r\n          (this.settings.speed * 0.1 - this.velocity.y) * customEaseIn;\r\n      } else {\r\n        this.velocity.x = this.settings.speed * 0.1;\r\n        this.velocity.y = this.settings.speed * 0.1;\r\n      }\r\n    }\r\n\r\n    if (this.velocity.x !== 0 || this.velocity.y !== 0) {\r\n      if (this.settings.autoEasing) {\r\n        this.rotation.x +=\r\n          (this.velocity.x - this.rotation.x) * this.settings.easing;\r\n        this.rotation.y +=\r\n          (this.velocity.y - this.rotation.y) * this.settings.easing;\r\n      } else {\r\n        this.rotation.x += this.velocity.x;\r\n        this.rotation.y += this.velocity.y;\r\n      }\r\n\r\n      const shape = this.settings.shape || DEFAULT_SHAPE;\r\n      if (shape === \"ring\" || shape === \"helix\") {\r\n        this.rotation.x = 0;\r\n      } else if (shape === \"verticalRing\") {\r\n        this.rotation.y = 0;\r\n      }\r\n\r\n      const cosY = Math.cos(this.rotation.y),\r\n        sinY = Math.sin(this.rotation.y);\r\n      const cosX = Math.cos(this.rotation.x),\r\n        sinX = Math.sin(this.rotation.x);\r\n\r\n      this.tags.forEach((tag) => {\r\n        let { x, y, z } = tag;\r\n\r\n        let nx = x * cosY - z * sinY;\r\n        let nz = x * sinY + z * cosY;\r\n        let ny = y * cosX - nz * sinX;\r\n        nz = y * sinX + nz * cosX;\r\n        tag.x = nx;\r\n        tag.y = ny;\r\n        tag.z = nz;\r\n      });\r\n    }\r\n\r\n    this._draw();\r\n    this.animFrame = requestAnimationFrame(this._animate.bind(this));\r\n  }\r\n\r\n  /**\r\n   * Pauses the animation of the tag cloud.\r\n   */\r\n  pause() {\r\n    this.settings.paused = true;\r\n    if (this.animFrame) {\r\n      cancelAnimationFrame(this.animFrame);\r\n      this.animFrame = null;\r\n    }\r\n    this._events.pause?.forEach((cb) => cb());\r\n  }\r\n\r\n  /**\r\n   * Resumes the animation of the tag cloud.\r\n   */\r\n  resume() {\r\n    if (!this.settings.paused) return;\r\n    this.settings.paused = false;\r\n    this._animate();\r\n    this._events.resume?.forEach((cb) => cb());\r\n  }\r\n\r\n  /**\r\n   * Destroys the Orbity instance, removing all event listeners and clearing the canvas.\r\n   */\r\n  destroy() {\r\n    this.pause();\r\n    window.removeEventListener(\"resize\", this._resize);\r\n    this.canvas.removeEventListener(\"touchstart\", this._touchStartHandler);\r\n    this.canvas.removeEventListener(\"touchmove\", this._touchMoveHandler);\r\n    this.canvas.removeEventListener(\"touchend\", this._bindTouch);\r\n    this.canvas.removeEventListener(\"mousedown\", this._bindMouse);\r\n    this.canvas.removeEventListener(\"mousemove\", this._onCanvasMouseMove);\r\n    this.canvas.removeEventListener(\"mouseup\", this._bindMouse);\r\n    this.canvas.removeEventListener(\"mouseleave\", this._onCanvasMouseLeave);\r\n    this.canvas.removeEventListener(\"click\", this._onCanvasClick);\r\n    window.removeEventListener(\"deviceorientation\", this._orientationHandler);\r\n    if (this.canvas.parentNode) {\r\n      this.canvas.replaceWith(this.canvas.cloneNode(true));\r\n    }\r\n    this.tags = [];\r\n  }\r\n\r\n  /**\r\n   * Updates the index property of each tag to match its position in the tags array.\r\n   * @private\r\n   */\r\n  _reindexTags() {\r\n    this.tags.forEach((tag, i) => {\r\n      tag.index = i;\r\n    });\r\n  }\r\n}\r\nexport default Orbity;\r\n"],"names":["DEFAULT_SHAPE","EASING_PROFILES","Snappy","easeIn","friction","Smooth","Marathon","constructor","canvas","options","this","ctx","getContext","tags","settings","Object","assign","radius","speed","easing","enableEasing","paused","enableTouch","enableOrientation","maxVelocity","shape","enableDrag","enableClick","autoSpin","hoverEffect","clickEffect","hoverScale","hoverColor","hoverOpacity","customFont","customFontWeight","easingProfile","customEaseIn","customFriction","autoEasing","minVelocityThreshold","rotation","x","y","velocity","touch","active","animFrame","_events","tagClick","tagHover","tagLeave","_hoveredIndex","undoStack","redoStack","Math","min","max","_orientationHandler","_handleOrientation","bind","_touchStartHandler","_onTouchStart","_touchMoveHandler","_onTouchMove","_mouseMoveHandler","_onCanvasMouseMove","_mouseLeaveHandler","_onCanvasMouseLeave","_clickHandler","_onCanvasClick","_init","_throttle","func","limit","lastFunc","lastRan","args","context","clearTimeout","setTimeout","Date","now","apply","_resize","window","addEventListener","_bindTouch","_bindMouse","_bindOrientation","_attachInteraction","setAttribute","_positionTags","_animate","width","offsetWidth","height","offsetHeight","center","setTags","dataArray","map","data","i","angleX","random","PI","angleY","index","_screen","_scale","_color","color","_opacity","_reindexTags","_draw","_getRandomAngle","addTag","tagData","_validateTag","newTag","length","push","action","tag","removeTag","removedTag","splice","updateTag","console","error","oldData","newData","undo","lastAction","pop","redo","clearTags","updateOptions","newOptions","undefined","validShapes","includes","join","removeEventListener","pause","resume","setEasingProfile","toggleAutoEasing","text","test","_bindDragEvents","startEvent","moveEvent","endEvent","getPosition","_dragHandlers","mouseleave","isDragging","lastX","lastY","startHandler","e","pos","moveHandler","dx","dy","preventDefault","endHandler","_applyDragEasing","leaveHandler","passive","touches","clientX","clientY","event","profileName","enabled","easeOut","abs","requestAnimationFrame","lastUpdate","gamma","beta","pt","_getPointer","_getTagAt","distance","sqrt","velocityMagnitude","prev","forEach","cb","rect","getBoundingClientRect","left","top","s","R","N","majorRadius","minorRadius","majorSteps","ceil","minorSteps","majorAngle","minorAngle","floor","cos","sin","z","side","cbrt","threshold","validTags","levels","level","levelSize","angle","turns","spacing","heightStep","circumferenceTags","gridCols","gridRows","spacingX","spacingZ","col","row","goldenRatio","angleIncrement","t","inclination","acos","azimuth","clearRect","sortedTags","filter","sort","a","b","denominator","scale","isFinite","fontSize","maxZ","minZ","normalizedZ","opacity","globalAlpha","fillStyle","font","metrics","measureText","fillText","cosY","sinY","cosX","sinX","nx","nz","ny","cancelAnimationFrame","destroy","parentNode","replaceWith","cloneNode"],"mappings":"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"}